:- module (make.make_info).
:- interface.
:- use_module backend_libs.
:- use_module libs.
:- use_module list.
:- use_module map.
:- use_module maybe.
:- use_module mdbcomp.
:- use_module parse_tree.
:- use_module set.
:- use_module version_array.
:- use_module version_hash_table.
:- use_module (backend_libs.compile_target_code).
:- use_module (libs.file_util).
:- use_module (libs.globals).
:- use_module (libs.timestamp).
:- use_module (make.build).
:- use_module (make.deps_cache).
:- use_module (make.deps_set).
:- use_module (make.options_file).
:- use_module (mdbcomp.sym_name).
:- use_module (parse_tree.module_dep_info).
:- use_module (parse_tree.read_modules).
:- type c_header_type
    --->    header_mh 
    ;       header_mih .
:- type compilation_task_type
    --->    process_module(make.make_info.module_compilation_task_type)
    ;       target_code_to_object_code(backend_libs.compile_target_code.pic)
    ;       foreign_code_to_object_code(backend_libs.compile_target_code.pic, libs.globals.foreign_language)
    ;       fact_table_code_to_object_code(backend_libs.compile_target_code.pic, libs.file_util.file_name).
:- type dependency_file
    --->    dep_target(make.make_info.target_file)
    ;       dep_file(libs.file_util.file_name).
:- type dependency_file_index_map
    --->    dependency_file_index_map(((make.make_info).dfim_forward_map) :: version_hash_table.version_hash_table(make.make_info.dependency_file_with_module_index, make.deps_set.dependency_file_index), ((make.make_info).dfim_reverse_map) :: version_array.version_array(make.make_info.dependency_file_with_module_index), ((make.make_info).dfim_counter) :: uint).
:- type dependency_file_with_module_index
    --->    dfmi_target(make.deps_set.module_index, make.make_info.module_target_type)
    ;       dfmi_file(libs.file_util.file_name).
:- type dependency_status
    --->    deps_status_not_considered 
    ;       deps_status_being_built 
    ;       deps_status_up_to_date 
    ;       deps_status_error .
:- type file_timestamps == map.map(string, maybe.maybe_error(libs.timestamp.timestamp)).
:- type import_or_include
    --->    ioi_import(mdbcomp.sym_name.module_name)
    ;       ioi_include(mdbcomp.sym_name.module_name).
:- type linked_target_file
    --->    linked_target_file(((make.make_info).linked_tf_name) :: mdbcomp.sym_name.module_name, ((make.make_info).linked_tf_type) :: backend_libs.compile_target_code.linked_target_type).
:- type make_error
    --->    make_error_target(make.make_info.target_file)
    ;       make_error_dependencies(mdbcomp.sym_name.module_name)
    ;       make_error_other(string).
:- type make_info.
:- type maybe_keep_going
    --->    do_not_keep_going 
    ;       do_keep_going .
:- type maybe_module_dep_info
    --->    no_module_dep_info 
    ;       some_module_dep_info(parse_tree.module_dep_info.module_dep_info).
:- type maybe_rebuild_module_deps
    --->    do_rebuild_module_deps 
    ;       do_not_rebuild_module_deps .
:- type misc_target_type
    --->    misc_target_clean 
    ;       misc_target_realclean 
    ;       misc_target_build_all(make.make_info.module_target_type)
    ;       misc_target_build_analyses 
    ;       misc_target_build_library 
    ;       misc_target_install_library 
    ;       misc_target_build_xml_docs .
:- type module_compilation_task_type
    --->    task_errorcheck 
    ;       task_make_int0 
    ;       task_make_int12 
    ;       task_make_int3 
    ;       task_make_opt 
    ;       task_make_analysis_registry 
    ;       task_compile_to_target_code 
    ;       task_make_xml_doc .
:- type module_index_map
    --->    module_index_map(((make.make_info).mim_forward_map) :: version_hash_table.version_hash_table(mdbcomp.sym_name.module_name, make.deps_set.module_index), ((make.make_info).mim_reverse_map) :: version_array.version_array(mdbcomp.sym_name.module_name), ((make.make_info).mim_counter) :: uint).
:- type module_target_type
    --->    module_target_source 
    ;       module_target_errors 
    ;       module_target_int0 
    ;       module_target_int1 
    ;       module_target_int2 
    ;       module_target_int3 
    ;       module_target_opt 
    ;       module_target_analysis_registry 
    ;       module_target_track_flags 
    ;       module_target_c_header(make.make_info.c_header_type)
    ;       module_target_c_code 
    ;       module_target_csharp_code 
    ;       module_target_java_code 
    ;       module_target_java_class_code 
    ;       module_target_object_code(backend_libs.compile_target_code.pic)
    ;       module_target_foreign_object(backend_libs.compile_target_code.pic, libs.globals.foreign_language)
    ;       module_target_fact_table_object(backend_libs.compile_target_code.pic, libs.file_util.file_name)
    ;       module_target_xml_doc .
:- type target_file
    --->    target_file(((make.make_info).target_file_name) :: mdbcomp.sym_name.module_name, ((make.make_info).target_file_type) :: make.make_info.module_target_type).
:- type target_file_timestamps == version_hash_table.version_hash_table(make.make_info.target_file, libs.timestamp.timestamp).
:- type target_type
    --->    module_target(make.make_info.module_target_type)
    ;       linked_target(backend_libs.compile_target_code.linked_target_type)
    ;       misc_target(make.make_info.misc_target_type).
:- type top_target_file
    --->    top_target_file(((make.make_info).ttf_name) :: mdbcomp.sym_name.module_name, ((make.make_info).ttf_type) :: make.make_info.target_type).
:- func init_make_info(make.options_file.options_variables, list.list(string), make.make_info.maybe_keep_going, list.list(string), set.set(make.make_info.top_target_file), int, make.make_info.target_file_timestamps, make.make_info.module_index_map, make.make_info.dependency_file_index_map, version_hash_table.version_hash_table(make.make_info.dependency_file, make.make_info.dependency_status)) = make.make_info.make_info.
:- func make_info_get_cached_computed_module_deps(make.make_info.make_info) = make.deps_cache.cached_computed_module_deps.
:- func make_info_get_cached_direct_imports(make.make_info.make_info) = make.deps_cache.cached_direct_imports.
:- func make_info_get_cached_indirect_imports(make.make_info.make_info) = make.deps_cache.cached_indirect_imports.
:- func make_info_get_cached_non_intermod_direct_imports(make.make_info.make_info) = make.deps_cache.cached_direct_imports.
:- func make_info_get_cached_transitive_dependencies(make.make_info.make_info) = make.deps_cache.cached_transitive_dependencies.
:- func make_info_get_cached_transitive_foreign_imports(make.make_info.make_info) = make.deps_cache.cached_transitive_foreign_imports.
:- func make_info_get_command_line_targets(make.make_info.make_info) = set.set(make.make_info.top_target_file).
:- func make_info_get_dep_file_index_map(make.make_info.make_info) = make.make_info.dependency_file_index_map.
:- func make_info_get_dependency_status(make.make_info.make_info) = version_hash_table.version_hash_table(make.make_info.dependency_file, make.make_info.dependency_status).
:- func make_info_get_detected_grade_flags(make.make_info.make_info) = list.list(string).
:- func make_info_get_error_file_modules(make.make_info.make_info) = set.set(mdbcomp.sym_name.module_name).
:- func make_info_get_file_timestamps(make.make_info.make_info) = make.make_info.file_timestamps.
:- func make_info_get_importing_module(make.make_info.make_info) = maybe.maybe(make.make_info.import_or_include).
:- func make_info_get_keep_going(make.make_info.make_info) = make.make_info.maybe_keep_going.
:- func make_info_get_maybe_stdout_lock(make.make_info.make_info) = maybe.maybe(make.build.stdout_lock).
:- func make_info_get_mi_read_module_maps(make.make_info.make_info) = parse_tree.read_modules.have_read_module_maps.
:- func make_info_get_module_dependencies(make.make_info.make_info) = map.map(mdbcomp.sym_name.module_name, make.make_info.maybe_module_dep_info).
:- func make_info_get_module_index_map(make.make_info.make_info) = make.make_info.module_index_map.
:- func make_info_get_option_args(make.make_info.make_info) = list.list(string).
:- func make_info_get_options_variables(make.make_info.make_info) = make.options_file.options_variables.
:- func make_info_get_reanalysis_passes(make.make_info.make_info) = int.
:- func make_info_get_rebuild_module_deps(make.make_info.make_info) = make.make_info.maybe_rebuild_module_deps.
:- func make_info_get_target_file_timestamps(make.make_info.make_info) = make.make_info.target_file_timestamps.
:- pred make_info_set_cached_computed_module_deps(make.deps_cache.cached_computed_module_deps, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_cached_computed_module_deps((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_cached_direct_imports(make.deps_cache.cached_direct_imports, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_cached_direct_imports((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_cached_indirect_imports(make.deps_cache.cached_indirect_imports, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_cached_indirect_imports((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_cached_non_intermod_direct_imports(make.deps_cache.cached_direct_imports, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_cached_non_intermod_direct_imports((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_cached_transitive_dependencies(make.deps_cache.cached_transitive_dependencies, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_cached_transitive_dependencies((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_cached_transitive_foreign_imports(make.deps_cache.cached_transitive_foreign_imports, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_cached_transitive_foreign_imports((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_command_line_targets(set.set(make.make_info.top_target_file), make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_command_line_targets((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_dep_file_index_map(make.make_info.dependency_file_index_map, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_dep_file_index_map((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_dependency_status(version_hash_table.version_hash_table(make.make_info.dependency_file, make.make_info.dependency_status), make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_dependency_status((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_error_file_modules(set.set(mdbcomp.sym_name.module_name), make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_error_file_modules((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_file_timestamps(make.make_info.file_timestamps, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_file_timestamps((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_importing_module(maybe.maybe(make.make_info.import_or_include), make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_importing_module((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_maybe_stdout_lock(maybe.maybe(make.build.stdout_lock), make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_maybe_stdout_lock((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_module_dependencies(map.map(mdbcomp.sym_name.module_name, make.make_info.maybe_module_dep_info), make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_module_dependencies((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_module_index_map(make.make_info.module_index_map, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_module_index_map((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_option_args(list.list(string), make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_option_args((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_reanalysis_passes(int, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_reanalysis_passes((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_rebuild_module_deps(make.make_info.maybe_rebuild_module_deps, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_rebuild_module_deps((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred make_info_set_target_file_timestamps(make.make_info.target_file_timestamps, make.make_info.make_info, make.make_info.make_info).
:- mode make_info_set_target_file_timestamps((builtin.in), (builtin.in), (builtin.out)) is det.
