:- module (make.util).
:- interface.
:- import_module (libs.globals).
:- type build(T) == make.util.build(T, make.make_info).
:- type build(T, Info) == make.util.build(T, Info, Info).
:- type build(T, Info1, Info2) == pred(libs.globals.globals, T, bool.bool, Info1, Info2, io.io, io.io).
:- type build2(T, U) == pred(libs.globals.globals, T, U, bool.bool, make.make_info, make.make_info, io.io, io.io).
:- type foldl2_pred_with_status(T, Info, IO) == pred(libs.globals.globals, T, bool.bool, Info, Info, IO, IO).
:- type foldl3_pred_with_status(T, Acc, Info, IO) == pred(libs.globals.globals, T, bool.bool, Acc, Acc, Info, Info, IO, IO).
:- type stdout_lock.
:- inst (build) == (pred((builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det).
:- inst (build2) == (pred((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det).
:- inst (foldl2_pred_with_status) == (pred((builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det).
:- inst (foldl3_pred_with_status) == (pred((builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det).
:- pred build_with_module_options(libs.globals.globals, mdbcomp.sym_name.module_name, list.list(string), make.util.build(list.list(string)), bool.bool, make.make_info, make.make_info, io.io, io.io).
:- mode build_with_module_options((builtin.in), (builtin.in), (builtin.in), builtin.in(((make.util).build)), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred build_with_module_options_and_output_redirect(libs.globals.globals, mdbcomp.sym_name.module_name, list.list(string), make.util.build2(list.list(string), io.output_stream), bool.bool, make.make_info, make.make_info, io.io, io.io).
:- mode build_with_module_options_and_output_redirect((builtin.in), (builtin.in), (builtin.in), builtin.in(((make.util).build2)), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred build_with_module_options_args(libs.globals.globals, mdbcomp.sym_name.module_name, list.list(string), make.options_file.options_variables, list.list(string), list.list(string), make.util.build(list.list(string), Info1, Info2), bool.bool, Info1, maybe.maybe(Info2), io.io, io.io).
:- mode build_with_module_options_args((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), builtin.in(((make.util).build)), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred build_with_output_redirect(libs.globals.globals, mdbcomp.sym_name.module_name, make.util.build(io.output_stream), bool.bool, make.make_info, make.make_info, io.io, io.io).
:- mode build_with_output_redirect((builtin.in), (builtin.in), builtin.in(((make.util).build)), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred debug_file_msg(libs.globals.globals, make.target_file, string, io.io, io.io).
:- mode debug_file_msg((builtin.in), (builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred debug_make_msg(libs.globals.globals, pred(io.io, io.io), io.io, io.io).
:- mode debug_make_msg((builtin.in), (pred((builtin.di), (builtin.uo)) is det), (builtin.di), (builtin.uo)) is det.
:- pred dependency_file_hash(make.dependencies.dependency_file, int).
:- mode dependency_file_hash((builtin.in), (builtin.out)) is det.
:- pred file_error(make.make_info, libs.file_util.file_name, io.io, io.io).
:- mode file_error((builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- func find_oldest_timestamp(maybe.maybe_error(libs.timestamp.timestamp), maybe.maybe_error(libs.timestamp.timestamp)) = maybe.maybe_error(libs.timestamp.timestamp).
:- pred foldl2_maybe_stop_at_error(bool.bool, make.util.foldl2_pred_with_status(T, Info, IO), libs.globals.globals, list.list(T), bool.bool, Info, Info, IO, IO).
:- mode foldl2_maybe_stop_at_error((builtin.in), builtin.in(((make.util).foldl2_pred_with_status)), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred foldl2_maybe_stop_at_error_maybe_parallel(bool.bool, make.util.foldl2_pred_with_status(T, make.make_info, io.io), libs.globals.globals, list.list(T), bool.bool, make.make_info, make.make_info, io.io, io.io).
:- mode foldl2_maybe_stop_at_error_maybe_parallel((builtin.in), builtin.in(((make.util).foldl2_pred_with_status)), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred foldl3_maybe_stop_at_error(bool.bool, make.util.foldl3_pred_with_status(T, Acc, Info, IO), libs.globals.globals, list.list(T), bool.bool, Acc, Acc, Info, Info, IO, IO).
:- mode foldl3_maybe_stop_at_error((builtin.in), builtin.in(((make.util).foldl3_pred_with_status)), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred get_dependency_timestamp(libs.globals.globals, make.dependencies.dependency_file, maybe.maybe_error(libs.timestamp.timestamp), make.make_info, make.make_info, io.io, io.io).
:- mode get_dependency_timestamp((builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred get_file_name(libs.globals.globals, parse_tree.file_names.maybe_search, make.target_file, libs.file_util.file_name, make.make_info, make.make_info, io.io, io.io).
:- mode get_file_name((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred get_file_timestamp(list.list(libs.file_util.dir_name), libs.file_util.file_name, maybe.maybe_error(libs.timestamp.timestamp), make.make_info, make.make_info, io.io, io.io).
:- mode get_file_timestamp((builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred get_real_milliseconds(int, io.io, io.io).
:- mode get_real_milliseconds((builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred get_target_timestamp(libs.globals.globals, parse_tree.file_names.maybe_search, make.target_file, maybe.maybe_error(libs.timestamp.timestamp), make.make_info, make.make_info, io.io, io.io).
:- mode get_target_timestamp((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred get_timestamp_file_timestamp(libs.globals.globals, make.target_file, maybe.maybe_error(libs.timestamp.timestamp), make.make_info, make.make_info, io.io, io.io).
:- mode get_timestamp_file_timestamp((builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred linked_target_file_name(libs.globals.globals, mdbcomp.sym_name.module_name, backend_libs.compile_target_code.linked_target_type, libs.file_util.file_name, io.io, io.io).
:- mode linked_target_file_name((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- func make_dependency_list(list.list(mdbcomp.sym_name.module_name), make.module_target_type) = list.list(make.dependencies.dependency_file).
:- pred make_remove_file(libs.globals.globals, libs.options.option, libs.file_util.file_name, make.make_info, make.make_info, io.io, io.io).
:- mode make_remove_file((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred make_remove_module_file(libs.globals.globals, libs.options.option, mdbcomp.sym_name.module_name, string, make.make_info, make.make_info, io.io, io.io).
:- mode make_remove_module_file((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred make_remove_target_file(libs.globals.globals, libs.options.option, make.target_file, make.make_info, make.make_info, io.io, io.io).
:- mode make_remove_target_file((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred make_remove_target_file_by_name(libs.globals.globals, libs.options.option, mdbcomp.sym_name.module_name, make.module_target_type, make.make_info, make.make_info, io.io, io.io).
:- mode make_remove_target_file_by_name((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- func make_target_file_list(list.list(mdbcomp.sym_name.module_name), make.module_target_type) = list.list(make.target_file).
:- pred make_write_dependency_file(libs.globals.globals, make.dependencies.dependency_file, io.io, io.io).
:- mode make_write_dependency_file((builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred make_write_dependency_file_list(libs.globals.globals, list.list(make.dependencies.dependency_file), io.io, io.io).
:- mode make_write_dependency_file_list((builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred make_write_target_file(libs.globals.globals, make.target_file, io.io, io.io).
:- mode make_write_target_file((builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred make_write_target_file_wrapped(libs.globals.globals, string, make.target_file, string, io.io, io.io).
:- mode make_write_target_file_wrapped((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred maybe_make_linked_target_message(libs.globals.globals, libs.file_util.file_name, io.io, io.io).
:- mode maybe_make_linked_target_message((builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred maybe_make_target_message(libs.globals.globals, make.target_file, io.io, io.io).
:- mode maybe_make_target_message((builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred maybe_make_target_message_to_stream(libs.globals.globals, io.output_stream, make.target_file, io.io, io.io).
:- mode maybe_make_target_message_to_stream((builtin.in), (builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred maybe_reanalyse_modules_message(libs.globals.globals, io.io, io.io).
:- mode maybe_reanalyse_modules_message((builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred maybe_symlink_or_copy_linked_target_message(libs.globals.globals, pair.pair(mdbcomp.sym_name.module_name, make.target_type), io.io, io.io).
:- mode maybe_symlink_or_copy_linked_target_message((builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred maybe_warn_up_to_date_target(libs.globals.globals, pair.pair(mdbcomp.sym_name.module_name, make.target_type), make.make_info, make.make_info, io.io, io.io).
:- mode maybe_warn_up_to_date_target((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred module_name_hash(mdbcomp.sym_name.module_name, int).
:- mode module_name_hash((builtin.in), (builtin.out)) is det.
:- pred redirect_output(mdbcomp.sym_name.module_name, maybe.maybe(io.output_stream), make.make_info, make.make_info, io.io, io.io).
:- mode redirect_output((builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- func target_extension(libs.globals.globals, make.module_target_type) = maybe.maybe(string).
:- mode target_extension((builtin.in), (builtin.in)) = (builtin.out) is det.
:- mode target_extension((builtin.in), (builtin.out)) = builtin.in(bound(yes(ground))) is nondet.
:- pred target_extension_synonym(string, make.module_target_type).
:- mode target_extension_synonym((builtin.in), (builtin.out)) is semidet.
:- pred target_file_error(make.make_info, libs.globals.globals, make.target_file, io.io, io.io).
:- mode target_file_error((builtin.in), (builtin.in), (builtin.in), (builtin.di), (builtin.uo)) is det.
:- pred target_is_grade_or_arch_dependent(make.module_target_type).
:- mode target_is_grade_or_arch_dependent((builtin.in)) is semidet.
:- pred timestamp_extension(make.module_target_type, string).
:- mode timestamp_extension((builtin.in), (builtin.out)) is semidet.
:- pred unredirect_output(libs.globals.globals, mdbcomp.sym_name.module_name, io.output_stream, make.make_info, make.make_info, io.io, io.io).
:- mode unredirect_output((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.di), (builtin.uo)) is det.
:- pred verbose_make_msg(libs.globals.globals, pred(io.io, io.io), io.io, io.io).
:- mode verbose_make_msg((builtin.in), (pred((builtin.di), (builtin.uo)) is det), (builtin.di), (builtin.uo)) is det.
:- pred verbose_make_msg_option(libs.globals.globals, libs.options.option, pred(io.io, io.io), io.io, io.io).
:- mode verbose_make_msg_option((builtin.in), (builtin.in), (pred((builtin.di), (builtin.uo)) is det), (builtin.di), (builtin.uo)) is det.
:- pragma foreign_import_module("C", (make.util)).
:- pragma foreign_import_module("C#", (make.util)).
:- pragma foreign_import_module("Java", (make.util)).
:- pragma foreign_import_module("Erlang", (make.util)).
:- implementation.
:- type job_ctl.
:- pragma foreign_type(c, job_ctl, "MC_JobCtl *").
:- pragma foreign_type(csharp, job_ctl, "object").
:- pragma foreign_type(java, job_ctl, "java.lang.Object").
:- pragma foreign_type(erlang, job_ctl, "").
:- type stdout_lock == make.util.job_ctl.
