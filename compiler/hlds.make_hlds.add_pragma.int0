:- module ((hlds.make_hlds).add_pragma).
:- interface.
:- import_module list.
:- import_module parse_tree.
:- import_module (hlds.hlds_module).
:- import_module (parse_tree.error_util).
:- import_module (parse_tree.prog_item).
:- import_module ((hlds.make_hlds).qual_info).
:- inst (ims_pragma_foreign_enum) == (hlds.make_hlds).ims_item(((hlds.make_hlds).add_pragma).item_pragma_info_inst((((hlds.make_hlds).add_pragma).pragma_foreign_enum_inst))).
:- inst (ims_pragma_pass_2) == (hlds.make_hlds).ims_item(((hlds.make_hlds).add_pragma).item_pragma_info_inst((((hlds.make_hlds).add_pragma).pragma_pass_2_inst))).
:- inst (ims_pragma_pass_3) == (hlds.make_hlds).ims_item(((hlds.make_hlds).add_pragma).item_pragma_info_inst((((hlds.make_hlds).add_pragma).pragma_pass_3_inst))).
:- inst (ims_pragma_reserve_tag) == (hlds.make_hlds).ims_item(((hlds.make_hlds).add_pragma).item_pragma_info_inst((((hlds.make_hlds).add_pragma).pragma_reserve_tag_inst))).
:- inst (item_pragma_info_inst(I)) for (parse_tree.prog_item).item_pragma_info/0 == bound(item_pragma_info(I, ground, ground, ground)).
:- inst (pragma_foreign_enum_inst) for (parse_tree.prog_item).pragma_type/0 == bound(pragma_foreign_enum(ground)).
:- inst (pragma_pass_2_inst) for (parse_tree.prog_item).pragma_type/0 == bound(pragma_check_termination(ground) ; pragma_consider_used(ground) ; pragma_does_not_terminate(ground) ; pragma_exceptions(ground) ; pragma_external_proc(ground) ; pragma_foreign_code(ground) ; pragma_foreign_decl(ground) ; pragma_foreign_export_enum(ground) ; pragma_foreign_import_module(ground) ; pragma_inline(ground) ; pragma_mm_tabling_info(ground) ; pragma_mode_check_clauses(ground) ; pragma_no_detism_warning(ground) ; pragma_no_inline(ground) ; pragma_obsolete(ground) ; pragma_promise_eqv_clauses(ground) ; pragma_promise_pure(ground) ; pragma_promise_semipure(ground) ; pragma_require_feature_set(ground) ; pragma_require_tail_recursion(ground) ; pragma_terminates(ground) ; pragma_trailing_info(ground) ; pragma_unused_args(ground)).
:- inst (pragma_pass_3_inst) for (parse_tree.prog_item).pragma_type/0 == bound(pragma_fact_table(ground) ; pragma_foreign_proc(ground) ; pragma_foreign_proc_export(ground) ; pragma_oisu(ground) ; pragma_structure_reuse(ground) ; pragma_structure_sharing(ground) ; pragma_tabled(ground) ; pragma_termination2_info(ground) ; pragma_termination_info(ground) ; pragma_type_spec(ground)).
:- inst (pragma_reserve_tag_inst) for (parse_tree.prog_item).pragma_type/0 == bound(pragma_reserve_tag(ground)).
:- pred add_foreign_enum_pragmas(list.list(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info)), hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_foreign_enum_pragmas(builtin.in(list.list_skel((((hlds.make_hlds).add_pragma).ims_pragma_foreign_enum))), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pass_2_pragmas(list.list(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info)), hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pass_2_pragmas(builtin.in(list.list_skel((((hlds.make_hlds).add_pragma).ims_pragma_pass_2))), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pass_3_pragmas(list.list(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info)), hlds.hlds_module.module_info, hlds.hlds_module.module_info, hlds.make_hlds.qual_info.qual_info, hlds.make_hlds.qual_info.qual_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pass_3_pragmas(builtin.in(list.list_skel((((hlds.make_hlds).add_pragma).ims_pragma_pass_3))), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_reserve_tag_pragmas(list.list(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info)), hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_reserve_tag_pragmas(builtin.in(list.list_skel((((hlds.make_hlds).add_pragma).ims_pragma_reserve_tag))), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- implementation.
:- include_module (((hlds.make_hlds).add_pragma).add_foreign_enum).
:- include_module (((hlds.make_hlds).add_pragma).add_pragma_tabling).
:- include_module (((hlds.make_hlds).add_pragma).add_pragma_type_spec).
:- import_module bool.
:- import_module int.
:- import_module io.
:- import_module libs.
:- import_module list.
:- import_module ll_backend.
:- import_module map.
:- import_module mdbcomp.
:- import_module pair.
:- import_module parse_tree.
:- import_module require.
:- import_module set.
:- import_module transform_hlds.
:- import_module varset.
:- import_module (hlds.hlds_code_util).
:- import_module (hlds.hlds_module).
:- import_module (hlds.hlds_pred).
:- import_module (hlds.make_tags).
:- import_module (hlds.pred_table).
:- import_module (libs.globals).
:- import_module (libs.options).
:- import_module (ll_backend.fact_table).
:- import_module (mdbcomp.sym_name).
:- import_module (parse_tree.error_util).
:- import_module (parse_tree.prog_data_foreign).
:- import_module (parse_tree.prog_data_pragma).
:- import_module (parse_tree.prog_foreign).
:- import_module (parse_tree.prog_item).
:- import_module (parse_tree.prog_out).
:- import_module (parse_tree.prog_util).
:- import_module (transform_hlds.term_constr_main_types).
:- import_module (transform_hlds.term_constr_util).
:- import_module (transform_hlds.term_util).
:- import_module ((hlds.make_hlds).add_foreign_proc).
:- import_module ((hlds.make_hlds).add_pred).
:- import_module ((hlds.make_hlds).make_hlds_error).
:- import_module ((hlds.make_hlds).qual_info).
:- import_module (((hlds.make_hlds).add_pragma).add_foreign_enum).
:- import_module (((hlds.make_hlds).add_pragma).add_pragma_tabling).
:- import_module (((hlds.make_hlds).add_pragma).add_pragma_type_spec).
:- type add_marker_pred_info == pred(hlds.hlds_pred.pred_info, hlds.hlds_pred.pred_info).
:- inst (add_marker_pred_info) == (pred((builtin.in), (builtin.out)) is det).
:- pred add_fact_table_proc(hlds.hlds_pred.proc_id, hlds.hlds_pred.proc_id, hlds.hlds_pred.proc_table, mdbcomp.sym_name.sym_name, mdbcomp.prim_data.pred_or_func, parse_tree.prog_data.arity, list.list(parse_tree.prog_data.mer_type), hlds.status.pred_status, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_fact_table_proc((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_fact_table_procedures(list.list(hlds.hlds_pred.proc_id), hlds.hlds_pred.proc_id, hlds.hlds_pred.proc_table, mdbcomp.sym_name.sym_name, mdbcomp.prim_data.pred_or_func, parse_tree.prog_data.arity, list.list(parse_tree.prog_data.mer_type), hlds.status.pred_status, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_fact_table_procedures((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_foreign_enum_pragma(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info), hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_foreign_enum_pragma(builtin.in((((hlds.make_hlds).add_pragma).ims_pragma_foreign_enum)), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_marker_pred_info(hlds.hlds_pred.pred_marker, hlds.hlds_pred.pred_info, hlds.hlds_pred.pred_info).
:- mode add_marker_pred_info((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred add_pass_2_pragma(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info), hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pass_2_pragma(builtin.in((((hlds.make_hlds).add_pragma).ims_pragma_pass_2)), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pass_3_pragma(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info), hlds.hlds_module.module_info, hlds.hlds_module.module_info, hlds.make_hlds.qual_info.qual_info, hlds.make_hlds.qual_info.qual_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pass_3_pragma(builtin.in((((hlds.make_hlds).add_pragma).ims_pragma_pass_3)), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_exceptions(parse_tree.prog_item.pragma_info_exceptions, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_exceptions((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_fact_table(parse_tree.prog_item.pragma_info_fact_table, hlds.status.pred_status, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_fact_table((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_mm_tabling_info(parse_tree.prog_item.pragma_info_mm_tabling_info, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_mm_tabling_info((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_oisu(parse_tree.prog_item.pragma_info_oisu, hlds.status.item_mercury_status, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_oisu((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_require_tail_recursion(parse_tree.prog_item.pragma_info_require_tail_recursion, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_require_tail_recursion((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_require_tail_recursion_proc(parse_tree.prog_data_pragma.require_tail_recursion, parse_tree.prog_data.prog_context, parse_tree.prog_data.sym_name_and_arity, pair.pair(hlds.hlds_pred.proc_id, hlds.hlds_pred.proc_info), hlds.hlds_pred.pred_info, hlds.hlds_pred.pred_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_require_tail_recursion_proc((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_reserve_tag(parse_tree.prog_data.type_ctor, hlds.status.type_status, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_reserve_tag((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_structure_reuse(parse_tree.prog_item.pragma_info_structure_reuse, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_structure_reuse((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_structure_sharing(parse_tree.prog_item.pragma_info_structure_sharing, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_structure_sharing((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_termination2_info(parse_tree.prog_item.pragma_info_termination2_info, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_termination2_info((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_termination_info(parse_tree.prog_item.pragma_info_termination_info, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_termination_info((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_trailing_info(parse_tree.prog_item.pragma_info_trailing_info, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_trailing_info((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pragma_unused_args(parse_tree.prog_item.pragma_info_unused_args, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pragma_unused_args((builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_pred_marker(string, mdbcomp.sym_name.sym_name, parse_tree.prog_data.arity, hlds.status.pred_status, parse_tree.prog_data.prog_context, hlds.hlds_pred.pred_marker, list.list(hlds.hlds_pred.pred_marker), hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_pred_marker((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred add_reserve_tag_pragma(hlds.make_hlds.ims_item(parse_tree.prog_item.item_pragma_info), hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode add_reserve_tag_pragma(builtin.in((((hlds.make_hlds).add_pragma).ims_pragma_reserve_tag)), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred check_required_feature(libs.globals.globals, parse_tree.prog_data.prog_context, parse_tree.prog_data_pragma.required_feature, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode check_required_feature((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred check_required_feature_set(set.set(parse_tree.prog_data_pragma.required_feature), hlds.status.item_mercury_status, parse_tree.prog_data.prog_context, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode check_required_feature_set((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred do_add_pred_marker(string, mdbcomp.sym_name.sym_name, parse_tree.prog_data.arity, hlds.status.pred_status, bool.bool, term.context, hlds.make_hlds.add_pragma.add_marker_pred_info, hlds.hlds_module.module_info, hlds.hlds_module.module_info, list.list(hlds.hlds_pred.pred_id), list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode do_add_pred_marker((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), builtin.in((((hlds.make_hlds).add_pragma).add_marker_pred_info)), (builtin.in), (builtin.out), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred fact_table_pragma_vars(list.list(parse_tree.prog_data.prog_var), list.list(parse_tree.prog_data.mer_mode), parse_tree.prog_data.prog_varset, list.list(parse_tree.prog_data_foreign.pragma_var)).
:- mode fact_table_pragma_vars((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred find_unique_pred_for_oisu(hlds.hlds_module.module_info, parse_tree.prog_data.prog_context, parse_tree.prog_data.type_ctor, string, parse_tree.prog_item.pred_name_arity, hlds.hlds_pred.pred_id, int, int, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode find_unique_pred_for_oisu((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.in), (builtin.out), (builtin.in), (builtin.out)) is det.
:- pred get_matching_pred_ids(hlds.hlds_module.module_info, mdbcomp.sym_name.sym_name, parse_tree.prog_data.arity, list.list(hlds.hlds_pred.pred_id)).
:- mode get_matching_pred_ids((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred lookup_pred_orig_arity(hlds.hlds_module.module_info, hlds.hlds_pred.pred_id, parse_tree.error_util.format_component).
:- mode lookup_pred_orig_arity((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred mark_pred_as_external(hlds.hlds_pred.pred_id, hlds.hlds_module.module_info, hlds.hlds_module.module_info).
:- mode mark_pred_as_external((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred marker_must_be_exported(hlds.hlds_pred.pred_marker).
:- mode marker_must_be_exported((builtin.in)) is semidet.
:- pred pragma_add_marker(list.list(hlds.hlds_pred.pred_id), hlds.make_hlds.add_pragma.add_marker_pred_info, hlds.status.pred_status, bool.bool, hlds.pred_table.pred_table, hlds.pred_table.pred_table, bool.bool).
:- mode pragma_add_marker((builtin.in), builtin.in((((hlds.make_hlds).add_pragma).add_marker_pred_info)), (builtin.in), (builtin.in), (builtin.in), (builtin.out), (builtin.out)) is det.
:- pred pragma_check_markers(hlds.pred_table.pred_table, list.list(hlds.hlds_pred.pred_id), list.list(hlds.hlds_pred.pred_marker), bool.bool).
:- mode pragma_check_markers((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred pragma_conflict_error(mdbcomp.sym_name.sym_name, int, parse_tree.prog_data.prog_context, string, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode pragma_conflict_error((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred pragma_status_error(mdbcomp.sym_name.sym_name, int, parse_tree.prog_data.prog_context, string, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode pragma_status_error((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred report_if_pragma_is_wrongly_in_interface(hlds.status.item_mercury_status, parse_tree.prog_item.item_pragma_info, list.list(parse_tree.error_util.error_spec), list.list(parse_tree.error_util.error_spec)).
:- mode report_if_pragma_is_wrongly_in_interface((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
