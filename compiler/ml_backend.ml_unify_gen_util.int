:- module (ml_backend.ml_unify_gen_util).
:- interface.
:- import_module assoc_list.
:- import_module bool.
:- import_module hlds.
:- import_module list.
:- import_module maybe.
:- import_module parse_tree.
:- import_module (hlds.const_struct).
:- import_module (hlds.hlds_data).
:- import_module (hlds.hlds_goal).
:- import_module (hlds.hlds_module).
:- import_module (ml_backend.ml_gen_info).
:- import_module (ml_backend.mlds).
:- import_module (parse_tree.prog_data).
:- type arg_const_type_and_width == ml_backend.ml_unify_gen_util.arg_type_and_width(hlds.const_struct.const_struct_arg).
:- type arg_to_type(Arg) == ((func Arg) = parse_tree.prog_data.mer_type).
:- type arg_type_and_width(Arg)
    --->    arg_type_and_width(Arg, parse_tree.prog_data.mer_type, parse_tree.prog_data.arg_pos_width).
:- type arg_var_type_and_width == ml_backend.ml_unify_gen_util.arg_type_and_width(parse_tree.prog_data.prog_var).
:- type assign_dir
    --->    assign_nondummy_left 
    ;       assign_nondummy_right 
    ;       assign_nondummy_unused 
    ;       assign_dummy .
:- type cons_id_or_closure
    --->    ordinary_cons_id(parse_tree.prog_data.cons_id)
    ;       closure_object(int).
:- type field_gen
    --->    field_gen(maybe.maybe(hlds.hlds_data.ptag), ml_backend.mlds.mlds_rval, ml_backend.mlds.mlds_type, ml_backend.ml_unify_gen_util.field_via).
:- type field_via
    --->    field_via_offset 
    ;       field_via_name(ml_backend.mlds.mlds_module_name, ml_backend.mlds.mlds_type).
:- type may_have_extra_args
    --->    may_not_have_extra_args 
    ;       may_have_extra_args .
:- pred compute_assign_direction(hlds.hlds_module.module_info, hlds.hlds_goal.unify_mode, parse_tree.prog_data.mer_type, parse_tree.prog_data.mer_type, ml_backend.ml_unify_gen_util.assign_dir).
:- mode compute_assign_direction((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred cons_id_arg_types_and_widths(hlds.hlds_module.module_info, ml_backend.ml_unify_gen_util.arg_to_type(Arg), ml_backend.ml_unify_gen_util.may_have_extra_args, parse_tree.prog_data.mer_type, parse_tree.prog_data.cons_id, list.list(Arg), list.list(ml_backend.ml_unify_gen_util.arg_type_and_width(Arg))).
:- mode cons_id_arg_types_and_widths((builtin.in), (builtin.in), builtin.in(bound(may_have_extra_args)), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- mode cons_id_arg_types_and_widths((builtin.in), (builtin.in), builtin.in(bound(may_not_have_extra_args)), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred decide_field_gen(ml_backend.ml_gen_info.ml_gen_info, ml_backend.mlds.mlds_lval, parse_tree.prog_data.mer_type, parse_tree.prog_data.cons_id, hlds.hlds_data.cons_tag, ml_backend.ml_unify_gen_util.field_gen).
:- mode decide_field_gen((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred maybe_cons_id_arg_types_and_widths(ml_backend.ml_gen_info.ml_gen_info, parse_tree.prog_data.mer_type, ml_backend.ml_unify_gen_util.cons_id_or_closure, list.list(parse_tree.prog_data.prog_var), list.list(ml_backend.ml_unify_gen_util.arg_var_type_and_width)).
:- mode maybe_cons_id_arg_types_and_widths((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- func ml_bitwise_and(ml_backend.mlds.mlds_rval, int) = ml_backend.mlds.mlds_rval.
:- func ml_bitwise_or(ml_backend.mlds.mlds_rval, ml_backend.mlds.mlds_rval) = ml_backend.mlds.mlds_rval.
:- pred ml_cast_to_unsigned_without_sign_extend(parse_tree.prog_data.fill_kind, ml_backend.mlds.mlds_rval, ml_backend.mlds.mlds_rval).
:- mode ml_cast_to_unsigned_without_sign_extend((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred ml_cons_id_to_tag(ml_backend.ml_gen_info.ml_gen_info, parse_tree.prog_data.cons_id, hlds.hlds_data.cons_tag).
:- mode ml_cons_id_to_tag((builtin.in), (builtin.in), (builtin.out)) is det.
:- pred ml_field_names_and_types(ml_backend.ml_gen_info.ml_gen_info, parse_tree.prog_data.mer_type, parse_tree.prog_data.cons_id, parse_tree.prog_data.cell_offset, list.list(parse_tree.prog_data.prog_var), assoc_list.assoc_list(parse_tree.prog_data.prog_var, hlds.hlds_data.constructor_arg_repn)).
:- mode ml_field_names_and_types((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred ml_gen_secondary_tag_rval(ml_backend.ml_gen_info.ml_gen_info, parse_tree.prog_data.mer_type, ml_backend.mlds.mlds_rval, hlds.hlds_data.ptag, ml_backend.mlds.mlds_rval).
:- mode ml_gen_secondary_tag_rval((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- func ml_lshift(ml_backend.mlds.mlds_rval, parse_tree.prog_data.arg_shift, parse_tree.prog_data.fill_kind) = ml_backend.mlds.mlds_rval.
:- func ml_rshift(ml_backend.mlds.mlds_rval, parse_tree.prog_data.arg_shift) = ml_backend.mlds.mlds_rval.
:- pred ml_tag_initial_offset_and_argnum(hlds.hlds_data.cons_tag, hlds.hlds_data.ptag, parse_tree.prog_data.cell_offset, int).
:- mode ml_tag_initial_offset_and_argnum((builtin.in), (builtin.out), (builtin.out), (builtin.out)) is det.
:- pred ml_type_as_field(hlds.hlds_module.module_info, bool.bool, parse_tree.prog_data.mer_type, parse_tree.prog_data.arg_width, parse_tree.prog_data.mer_type).
:- mode ml_type_as_field((builtin.in), (builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred or_rvals(ml_backend.mlds.mlds_rval, list.list(ml_backend.mlds.mlds_rval), ml_backend.mlds.mlds_rval).
:- mode or_rvals((builtin.in), (builtin.in), (builtin.out)) is det.
