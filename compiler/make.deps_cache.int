:- module (make.deps_cache).
:- interface.
:- use_module libs.
:- use_module map.
:- use_module (libs.maybe_util).
:- use_module (make.deps_set).
:- use_module (make.make_info).
:- type cached_computed_module_deps == map.map(make.deps_cache.computed_module_deps_key, make.deps_cache.dependency_file_deps_result).
:- type cached_direct_imports == map.map(make.deps_set.module_index, make.deps_cache.module_deps_result).
:- type cached_indirect_imports == map.map(make.deps_set.module_index, make.deps_cache.module_deps_result).
:- type cached_transitive_dependencies == map.map(make.deps_cache.trans_deps_key, make.deps_cache.module_deps_result).
:- type cached_transitive_foreign_imports == map.map(make.deps_set.module_index, make.deps_cache.module_deps_result).
:- type computed_module_deps_key
    --->    computed_module_deps_key(make.deps_set.module_index, make.deps_cache.computed_module_deps_label).
:- type computed_module_deps_label
    --->    computed_module_deps_import_012 .
:- type dependency_file_deps_result == make.deps_cache.deps_result(make.deps_set.dependency_file_index).
:- type deps_result(T)
    --->    deps_result(((make.deps_cache).dr_success) :: libs.maybe_util.maybe_succeeded, ((make.deps_cache).dr_set) :: make.deps_set.deps_set(T)).
:- type module_deps_result == make.deps_cache.deps_result(make.deps_set.module_index).
:- type process_modules_where
    --->    process_only_modules_in_cur_dir 
    ;       process_modules_anywhere .
:- type trans_deps_key
    --->    trans_deps_key(make.deps_set.module_index, make.deps_cache.transitive_dependencies_type, make.deps_cache.process_modules_where).
:- type transitive_dependencies_type
    --->    interface_imports 
    ;       all_imports 
    ;       all_dependencies .
:- pred add_to_computed_module_deps_cache(make.deps_cache.computed_module_deps_key, make.deps_cache.dependency_file_deps_result, make.make_info.make_info, make.make_info.make_info).
:- mode add_to_computed_module_deps_cache((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred add_to_direct_imports_cache(make.deps_set.module_index, make.deps_cache.module_deps_result, make.make_info.make_info, make.make_info.make_info).
:- mode add_to_direct_imports_cache((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred add_to_indirect_imports_cache(make.deps_set.module_index, make.deps_cache.module_deps_result, make.make_info.make_info, make.make_info.make_info).
:- mode add_to_indirect_imports_cache((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred add_to_non_intermod_direct_imports_cache(make.deps_set.module_index, make.deps_cache.module_deps_result, make.make_info.make_info, make.make_info.make_info).
:- mode add_to_non_intermod_direct_imports_cache((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred add_to_transitive_deps_cache(make.deps_cache.trans_deps_key, make.deps_cache.module_deps_result, make.make_info.make_info, make.make_info.make_info).
:- mode add_to_transitive_deps_cache((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- pred add_to_transitive_foreign_imports_cache(make.deps_set.module_index, make.deps_cache.module_deps_result, make.make_info.make_info, make.make_info.make_info).
:- mode add_to_transitive_foreign_imports_cache((builtin.in), (builtin.in), (builtin.in), (builtin.out)) is det.
:- func init_cached_computed_module_deps = make.deps_cache.cached_computed_module_deps.
:- func init_cached_direct_imports = make.deps_cache.cached_direct_imports.
:- func init_cached_indirect_imports = make.deps_cache.cached_indirect_imports.
:- func init_cached_transitive_dependencies = make.deps_cache.cached_transitive_dependencies.
:- func init_cached_transitive_foreign_imports = make.deps_cache.cached_transitive_foreign_imports.
:- pred search_computed_module_deps_cache(make.make_info.make_info, make.deps_cache.computed_module_deps_key, make.deps_cache.dependency_file_deps_result).
:- mode search_computed_module_deps_cache((builtin.in), (builtin.in), (builtin.out)) is semidet.
:- pred search_direct_imports_cache(make.make_info.make_info, make.deps_set.module_index, make.deps_cache.module_deps_result).
:- mode search_direct_imports_cache((builtin.in), (builtin.in), (builtin.out)) is semidet.
:- pred search_indirect_imports_cache(make.make_info.make_info, make.deps_set.module_index, make.deps_cache.module_deps_result).
:- mode search_indirect_imports_cache((builtin.in), (builtin.in), (builtin.out)) is semidet.
:- pred search_non_intermod_direct_imports_cache(make.make_info.make_info, make.deps_set.module_index, make.deps_cache.module_deps_result).
:- mode search_non_intermod_direct_imports_cache((builtin.in), (builtin.in), (builtin.out)) is semidet.
:- pred search_transitive_deps_cache(make.make_info.make_info, make.deps_cache.trans_deps_key, make.deps_cache.module_deps_result).
:- mode search_transitive_deps_cache((builtin.in), (builtin.in), (builtin.out)) is semidet.
:- pred search_transitive_foreign_imports_cache(make.make_info.make_info, make.deps_set.module_index, make.deps_cache.module_deps_result).
:- mode search_transitive_foreign_imports_cache((builtin.in), (builtin.in), (builtin.out)) is semidet.
